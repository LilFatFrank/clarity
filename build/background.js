const u="solscan.io";function i(t,e){chrome.tabs.sendMessage(t,{type:"URL_CHANGED",url:e}).catch(()=>{})}function o(t){return!!t&&t.includes("://solscan.io/")}if(chrome.webNavigation?.onCommitted){const t={url:[{hostEquals:u}]},e=n=>i(n.tabId,n.url);chrome.webNavigation.onCommitted.addListener(e,t),chrome.webNavigation.onHistoryStateUpdated.addListener(e,t)}else console.warn("[vizor] webNavigation unavailable; using tabs fallback"),chrome.tabs.onUpdated.addListener((t,e,n)=>{const a=e.url??n.url;(e.status==="complete"||e.url)&&o(a)&&i(t,a)}),chrome.tabs.onActivated.addListener(async t=>{try{const e=await chrome.tabs.get(t.tabId);o(e.url)&&i(t.tabId,e.url)}catch{}});function h(t){if(t?.text&&typeof t.text=="string")return t.text;const e=[];if(t?.explainer&&e.push(String(t.explainer)),Array.isArray(t?.keypoints)&&t.keypoints.length){e.push("");for(const n of t.keypoints)e.push(`â€¢ ${String(n)}`)}return t?.when&&(e.push(""),e.push(String(t.when))),e.join(`
`).trim()||"No explanation available."}chrome.runtime.onMessage.addListener((t,e,n)=>{if(t?.type==="EXPLAIN_TX")return(async()=>{try{const a=String(t.signature||""),s=String(t.tz||Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC");if(!a){n({ok:!1,error:"Missing signature"});return}const r=await fetch("http://localhost:3001/api/transactions/explain",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({signature:a,tz:s})});if(!r.ok){n({ok:!1,error:`API ${r.status}`});return}const c=await r.json(),l=h(c);n({ok:!0,text:l})}catch(a){n({ok:!1,error:a?.message||String(a)})}})(),!0});
