const u="solscan.io";function s(t,e){chrome.tabs.sendMessage(t,{type:"URL_CHANGED",url:e}).catch(()=>{})}function c(t){return!!t&&t.includes("://solscan.io/")}if(chrome.webNavigation?.onCommitted){const t={url:[{hostEquals:u}]},e=r=>s(r.tabId,r.url);chrome.webNavigation.onCommitted.addListener(e,t),chrome.webNavigation.onHistoryStateUpdated.addListener(e,t)}else console.warn("[vizor] webNavigation unavailable; using tabs fallback"),chrome.tabs.onUpdated.addListener((t,e,r)=>{const a=e.url??r.url;(e.status==="complete"||e.url)&&c(a)&&s(t,a)}),chrome.tabs.onActivated.addListener(async t=>{try{const e=await chrome.tabs.get(t.tabId);c(e.url)&&s(t.tabId,e.url)}catch{}});function h(t){if(t?.text&&typeof t.text=="string")return t.text;const e=[];if(t?.explainer&&e.push(String(t.explainer)),Array.isArray(t?.keypoints)&&t.keypoints.length){e.push("");for(const r of t.keypoints)e.push(`â€¢ ${String(r)}`)}return t?.when&&(e.push(""),e.push(String(t.when))),e.join(`
`).trim()||"No explanation available."}chrome.runtime.onMessage.addListener((t,e,r)=>t?.type==="EXPLAIN_TX"?((async()=>{try{const a=String(t.signature||""),o=String(t.tz||Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC");if(!a){r({ok:!1,error:"Missing signature"});return}const i=await fetch("http://localhost:3001/api/transactions/explain",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({signature:a,tz:o})});if(!i.ok){r({ok:!1,error:`API ${i.status}`});return}const n=await i.json(),l=h(n);r({ok:!0,text:l})}catch(a){r({ok:!1,error:a?.message||String(a)})}})(),!0):t?.type==="EXPLAIN_ACCOUNT"?((async()=>{try{const a=String(t.address||""),o=String(t.tz||Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC");if(!a){r({ok:!1,error:"Missing address"});return}const i=await fetch("http://localhost:3001/api/wallets/insights",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({address:a,tz:o})});if(!i.ok){r({ok:!1,error:`API ${i.status}`});return}const n=await i.json();console.log("Account insights response:",n),r({ok:!0,data:n})}catch(a){r({ok:!1,error:a?.message||String(a)})}})(),!0):!1);
